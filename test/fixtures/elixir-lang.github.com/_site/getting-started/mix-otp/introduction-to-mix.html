<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>Introduction to Mix - Elixir</title>
  <link href="http://feeds.feedburner.com/ElixirLang" rel="alternate" title="Elixir's Blog" type="application/atom+xml" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <link rel="stylesheet" type="text/css" href="/css/syntax.css" />
  <link rel="stylesheet" href="/js/icons/style.css">
  <!--[if lt IE 8]><!-->
  <link rel="stylesheet" href="/js/icons/ie7/ie7.css">
  <!--<![endif]-->
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" id="font-bitter-css" href="http://fonts.googleapis.com/css?family=Bitter&amp;ver=1" type="text/css" media="screen" />
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
</head>

<body class="getting-started">
  <div id="container">
    <div class="wrap">
    <div id="header">
      <div id="branding">
        <h1 id="site-title">
          <a href="/" title="Elixir" rel="Home">
            <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo" />
          </a>
        </h1>
      </div>

      <div id="menu-primary" class="menu-container">
        <div class="menu">
          <ul id="menu-primary-items">
            <li class="menu-item home"><a class="spec" href="/">Home</a></li>
            <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
            <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Getting Started</a></li>
            <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
            <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
            <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
            <li class="menu-item packages"><a class="spec" href="http://hex.pm/">Packages</a></li>
          </ul>
        </div>
      </div>

      <div class="clear"></div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2014/09/18/elixir-v1-0-0-released/">Elixir v1.0 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="get" class="search-form" action="http://www.google.com/search">
		<div>
			<input class="search-text" type="text" name="q" placeholder="Search..." id="searchfield">
			<input type="hidden" name="sitesearch" value="elixir-lang.org">
			<input class="search-submit button" name="submit" type="submit" value="Search">
		</div>
	</form>
</div>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
        
          <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
        
          <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
        
          <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
        
          <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond and if">case, cond and if</a></li>
        
          <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings and char lists">Binaries, strings and char lists</a></li>
        
          <li><a class="spec" href="/getting-started/maps-and-dicts.html" title="Keywords, maps and dicts">Keywords, maps and dicts</a></li>
        
          <li><a class="spec" href="/getting-started/modules.html" title="Modules">Modules</a></li>
        
          <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
        
          <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
        
          <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
        
          <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
        
          <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require and import">alias, require and import</a></li>
        
          <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
        
          <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
        
          <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
        
          <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
        
          <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
        
          <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch and rescue">try, catch and rescue</a></li>
        
          <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
        
          <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
        
          <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
        
          <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
        
          <li><a class="spec" href="/getting-started/mix-otp/genevent.html" title="GenEvent">GenEvent</a></li>
        
          <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
        
          <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
        
          <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-apps.html" title="Dependencies and umbrella apps">Dependencies and umbrella apps</a></li>
        
          <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen-tcp">Task and gen-tcp</a></li>
        
          <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-pipelines.html" title="Docs, tests and pipelines">Docs, tests and pipelines</a></li>
        
          <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks-and-configuration.html" title="Distributed tasks and configuration">Distributed tasks and configuration</a></li>
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
        
          <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
        
          <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain Specific Languages">Domain Specific Languages</a></li>
        
      </ol>
    </div>
  

  <div id="sponsors" class="widget">
  <h3 class="widget-title">Sponsors</h3>
  <ul>
    <li class="image"><a href="http://plataformatec.com.br" title="Plataformatec"><img src="/images/logo/plataformatec.png" alt="Plataformatec Logo" width="190" height="74" /></a></li>
  </ul>
</div>
</div>

<div id="content">
  <article>
    <h1 id="introduction-to-mix">Introduction to Mix</h1>

<div id="toc" class="toc"></div>

<p>In this guide, we will learn how to build a complete Elixir application, with its own supervision tree, configuration, tests and more.</p>

<p>The application works as a distributed key-value store. We are going to organize key-value pairs into buckets and distribute those buckets across multiple nodes. We will also build a simple client that allows us to connect to any of those nodes and send requests such as:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">CREATE shopping
OK

PUT shopping milk 1
OK

PUT shopping eggs 3
OK

GET shopping milk
1
OK

DELETE shopping eggs
OK
</code></pre></div>
<p>In order to build our key-value application, we are going to use three main tools:</p>

<ul>
<li><p><strong><em>OTP</em></strong> <em>(Open Telecom Platform)</em> is a set of libraries that ships with Erlang. Erlang developers use OTP to build robust, fault-tolerant applications. In this chapter we will explore how many aspects from OTP integrate with Elixir, including supervision trees, event managers and more;</p></li>
<li><p><strong><em>Mix</em></strong> is a build tool that ships with Elixir that provides tasks for creating, compiling, testing your application, managing its dependencies and much more;</p></li>
<li><p><strong><em>ExUnit</em></strong> is a test-unit based framework that ships with Elixir;</p></li>
</ul>

<p>In this chapter, we will create our first project using Mix and explore different features in  <abbr title="Open Telecom Platform">OTP</abbr>, Mix and ExUnit as we go.</p>

<blockquote>
<p>Note: this guide requires Elixir v0.15.0 or later. You can check your Elixir version with <code>elixir -v</code> and install a more recent version if required by following the steps described in <a href="/getting-started/introduction.html">the first chapter of the Getting Started guide</a>.</p>

<p>If you have any questions or improvements to the guide, please let us know in <a href="https://groups.google.com/d/forum/elixir-lang-talk">our mailing list</a> or <a href="http://github.com/elixir-lang/elixir-lang.github.com/issues">issues tracker</a> respectively. Your input is really important to help us guarantee the guides are accessible and up to date!</p>
</blockquote>

<h2 id="our-first-project">Our first project</h2>

<p>When you install Elixir, besides getting the <code>elixir</code>, <code>elixirc</code> and <code>iex</code> executables, you also get an executable Elixir script named <code>mix</code>.</p>

<p>Let&#39;s create our first project by invoking <code>mix new</code> from the command line. We&#39;ll pass the project name as argument (<code>kv</code>, in this case), and tell mix that our main module should be the all-uppercase <code>KV</code>, instead of the default, which would have been <code>Kv</code>:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mix new kv --module KV
</code></pre></div>
<p>Mix will create a directory named <code>kv</code> with a few files in it:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">* creating README.md
* creating .gitignore
* creating mix.exs
* creating config
* creating config/config.exs
* creating lib
* creating lib/kv.ex
* creating test
* creating test/test_helper.exs
* creating test/kv_test.exs
</code></pre></div>
<p>Let&#39;s take a brief look at those generated files.</p>

<blockquote>
<p>Note: Mix is an Elixir executable. This means that in order to run <code>mix</code>, you need to have elixir&#39;s executable in your PATH. If not, you can run it by passing the script as argument to elixir:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bin/elixir bin/mix new kv --module KV
</code></pre></div>
<p>Note that you can also execute any script in your PATH from Elixir via the -S option:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bin/elixir -S mix new kv --module KV
</code></pre></div>
<p>When using -S, elixir finds the script wherever it is in your PATH and executes it.</p>
</blockquote>

<h2 id="project-compilation">Project compilation</h2>

<p>A file named <code>mix.exs</code> was generated inside our new project folder (<code>kv</code>) and its main responsibility is to configure our project. Let&#39;s take a look at it (comments removed):</p>
<div class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="kd">defmodule</span> <span class="nc">KV.Mixfile</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="nc">Mix.Project</span>

  <span class="kd">def</span> <span class="n">project</span> <span class="k">do</span>
    <span class="p">[</span><span class="ss">app</span><span class="p">:</span> <span class="ss">:kv</span><span class="p">,</span>
     <span class="ss">version</span><span class="p">:</span> <span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span>
     <span class="ss">deps</span><span class="p">:</span> <span class="n">deps</span><span class="p">]</span>
  <span class="k">end</span>

  <span class="kd">def</span> <span class="n">application</span> <span class="k">do</span>
    <span class="p">[</span><span class="ss">applications</span><span class="p">:</span> <span class="p">[</span><span class="ss">:logger</span><span class="p">]]</span>
  <span class="k">end</span>

  <span class="kd">defp</span> <span class="n">deps</span> <span class="k">do</span>
    <span class="p">[]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Our <code>mix.exs</code> defines two public functions: <code>project</code>, which returns project configuration like the project name and version, and <code>application</code>, which is used to generate an application file.</p>

<p>There is also a private function named <code>deps</code>, which is invoked from the <code>project</code> function, that defines our project dependencies. Defining <code>deps</code> as a separate function is not required, but it helps keep the project configuration tidy.</p>

<p>Mix also generates a file at <code>lib/kv.ex</code> with a simple module definition:</p>
<div class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="kd">defmodule</span> <span class="nc">KV</span> <span class="k">do</span>
<span class="k">end</span>
</code></pre></div>
<p>This structure is enough to compile our project:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>kv
<span class="nv">$ </span>mix compile
</code></pre></div>
<p>Will output:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Compiled lib/kv.ex
Generated kv.app
</code></pre></div>
<p>Notice the <code>lib/kv.ex</code> file was compiled and <code>kv.app</code> file was generated. All this took place in a directory structure of its own, inside the <code>_build</code> folder. This <code>.app</code> file is generated with the information from the <code>application/0</code> function in the <code>mix.exs</code> file. We will further explore <code>mix.exs</code> configuration features in future chapters.</p>

<p>Once the project is compiled, you can start an <code>iex</code> session inside the project by running:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>iex -S mix
</code></pre></div>
<h2 id="running-tests">Running tests</h2>

<p>Mix also generated the appropriate structure for running our project tests. Mix projects usually follow the convention of having a <code>&lt;filename&gt;_test.exs</code> file in the <code>test</code> directory for each file in the <code>lib</code> directory. For this reason, we can already find a <code>test/kv_test.exs</code> corresponding to our <code>lib/kv.ex</code> file. It doesn&#39;t do much at this point:</p>
<div class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="kd">defmodule</span> <span class="nc">KVTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="nc">ExUnit.Case</span>

  <span class="n">test</span> <span class="s2">&quot;the truth&quot;</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>It is important to note a couple things:</p>

<ol>
<li><p>the test file is an Elixir script file (<code>.exs</code>). This is convenient because we don&#39;t need to compile test files before running them;</p></li>
<li><p>we define a test module named <code>KVTest</code>, use <a href="/docs/stable/ex_unit/ExUnit.Case.html"><code>ExUnit.Case</code></a> to inject the testing API and define a simple test using the <code>test/2</code> macro;</p></li>
</ol>

<p>Mix also generated a file named <code>test/test_helper.exs</code> which is responsible for setting up the test framework:</p>
<div class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="nc">ExUnit</span><span class="p">.</span><span class="n">start</span>
</code></pre></div>
<p>This file will be automatically required by Mix every time before we run our tests. We can run tests with <code>mix test</code>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Compiled lib/kv.ex
Generated kv.app
.

Finished in 0.04 seconds (0.04s on load, 0.00s on tests)
1 tests, 0 failures

Randomized with seed 540224
</code></pre></div>
<p>Notice that by running <code>mix test</code>, Mix has compiled the source files and generated the application file once again. This happens because Mix supports multiple environments, which we will explore in the next section.</p>

<p>Furthermore, you can see that ExUnit prints a dot for each successful test and automatically randomizes tests too. Let&#39;s make the test fail on purpose and see what happens.</p>

<p>Change the assertion in <code>test/kv_test.exs</code> to the following:</p>
<div class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="n">assert</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">3</span>
</code></pre></div>
<p>Now run <code>mix test</code> again (notice this time there will be no compilation):</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">1) test the truth (KVTest)
   test/kv_test.exs:4
   Assertion with == failed
   code: 1 + 1 == 3
   lhs:  2
   rhs:  3
   stacktrace:
     test/kv_test.exs:5

Finished in 0.05 seconds (0.05s on load, 0.00s on tests)
1 tests, 1 failures
</code></pre></div>
<p>For each failure, ExUnit prints a detailed report, containing the test name with the test case, the code that failed and the values for the left-hand side (lhs) and right-hand side (rhs) of the <code>==</code> operator.</p>

<p>In the second line of the failure, right below the test name, there is the location where the test was defined. If you copy the test location in this full second line (including the file and line number) and append it to <code>mix test</code>, Mix will load and run just that particular test:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mix <span class="nb">test test</span>/kv_test.exs:4
</code></pre></div>
<p>This shortcut will be extremely useful as we build our project, allowing us to quickly iterate by running just a specific test.</p>

<p>Finally, the stacktrace relates to the failure itself, giving information about the test and often the place the failure was generated from within the source files.</p>

<h2 id="environments">Environments</h2>

<p>Mix supports the concept of &quot;environments&quot;. They allow a developer to customize compilation and other options for specific scenarios. By default, Mix understands three environments:</p>

<ul>
<li><code>:dev</code> - the one in which mix tasks (like <code>compile</code>) run by default</li>
<li><code>:test</code> - used by <code>mix test</code></li>
<li><code>:prod</code> - the one you will use to put your project in production</li>
</ul>

<blockquote>
<p>Note: If you add dependencies to your project, they will not inherit your project&#39;s environment, but instead run with their <code>:prod</code> environment settings!</p>
</blockquote>

<p>By default, these environments behave the same and all the configurations we have seen so far will affect all three environments. Customization per environment can be done by accessing <a href="/docs/stable/mix/Mix.html#env/1">the <code>Mix.env</code> function</a> in your <code>mix.exs</code> file, which returns the current environment as an atom:</p>
<div class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="kd">def</span> <span class="n">project</span> <span class="k">do</span>
  <span class="p">[</span><span class="ss">deps_path</span><span class="p">:</span> <span class="n">deps_path</span><span class="p">(</span><span class="nc">Mix</span><span class="p">.</span><span class="n">env</span><span class="p">)]</span>
<span class="k">end</span>

<span class="kd">defp</span> <span class="n">deps_path</span><span class="p">(</span><span class="ss">:prod</span><span class="p">),</span> <span class="ss">do</span><span class="p">:</span> <span class="s2">&quot;prod_deps&quot;</span>
<span class="kd">defp</span> <span class="n">deps_path</span><span class="p">(</span><span class="bp">_</span><span class="p">),</span> <span class="ss">do</span><span class="p">:</span> <span class="s2">&quot;deps&quot;</span>
</code></pre></div>
<p>Mix will default to the <code>:dev</code> environment, except for the <code>test</code> task that will default to the <code>:test</code> environment. The environment can be changed via the <code>MIX_ENV</code> environment variable:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ MIX_ENV</span><span class="o">=</span>prod mix compile
</code></pre></div>
<h2 id="exploring">Exploring</h2>

<p>There is much more to Mix, and we will continue to explore it as we build our project. A <a href="/docs/stable/mix/">general overview is available on the Mix documentation</a>.</p>

<p>Keep in mind that you can always invoke the help task to list all available tasks:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mix <span class="nb">help</span>
</code></pre></div>
<p>You can get further information about a particular task by invoking <code>mix help TASK</code>.</p>

<p>Let&#39;s write some code!</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
      
        
          <div class="pagination loop-pagination">
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/mix-otp/agent.html" class="previous page-numbers spec" title="Agent">Next &rarr;</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  

</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="copyright">
        &copy; 2012-2015 <a href="http://plataformatec.com.br/">Plataformatec</a>. All rights reserved.
      </div>
    </div><!-- .wrap -->
  </div><!-- #container -->

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8268430-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/toc/toc.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $('.toc').toc({
        title: '',
        listType: 'ol',
        minimumHeaders: 2,
        headers: 'h2, h3, h4, h5, h6',
        linkHere: true,
        linkHereTitle: 'Link here',
        backToTop: true,
        backToTopId: 'toc',
        backToTopTitle: 'Back to Table of Contents',
      });
      $('.jekyll-toc-header a.jekyll-toc-link-here span.jekyll-toc-icon').addClass('icon icon-link');
      $('.jekyll-toc-header a.jekyll-toc-back-to-top span.jekyll-toc-icon').addClass('icon icon-chevron-up');
    });

  </script>
</body>
</html>
